SELECT TOP 10 qt.*,rs.*
FROM sys.query_store_query_text AS qt
JOIN sys.query_store_query AS q
    ON qt.query_text_id = q.query_text_id
JOIN sys.query_store_plan AS p
    ON q.query_id = p.query_id
JOIN sys.query_store_runtime_stats AS rs
    ON p.plan_id = rs.plan_id
ORDER BY rs.avg_duration DESC
go


==Azure SQL DB
SELECT 
    qsrs.plan_id,
    qsrs.execution_type_desc,
    qsrs.first_execution_time,
    qsrs.last_execution_time,
    qsrs.count_executions,
    qsrs.avg_logical_io_reads,
    qsrs.avg_logical_io_writes,
    qsrs.avg_physical_io_reads,
    CAST(qsrs.avg_log_bytes_used / 1024.0 / 1024.0 AS DECIMAL(10,2)) AS avg_log_mb_used
FROM sys.query_store_runtime_stats qsrs
INNER JOIN sys.query_store_plan qsp ON qsrs.plan_id = qsp.plan_id
WHERE qsrs.first_execution_time >= DATEADD(day, -7, GETDATE())
ORDER BY qsrs.avg_log_bytes_used DESC;



SELECT 
    q.query_id,
    qt.query_sql_text,
    rs.first_execution_time,
    rs.last_execution_time,
    rs.count_executions,
    CAST(rs.avg_log_bytes_used / 1024.0 / 1024.0 AS DECIMAL(10,2)) AS avg_log_mb_used,
    CAST(rs.max_log_bytes_used / 1024.0 / 1024.0 AS DECIMAL(10,2)) AS max_log_mb_used,
    CAST((rs.count_executions * rs.avg_log_bytes_used) / 1024.0 / 1024.0 AS DECIMAL(10,2)) AS total_log_mb_used
FROM sys.query_store_runtime_stats rs
INNER JOIN sys.query_store_plan p ON rs.plan_id = p.plan_id
INNER JOIN sys.query_store_query q ON p.query_id = q.query_id
INNER JOIN sys.query_store_query_text qt ON q.query_text_id = qt.query_text_id
INNER JOIN sys.query_store_runtime_stats_interval rsi ON rs.runtime_stats_interval_id = rsi.runtime_stats_interval_id
WHERE rsi.start_time >= '2025-01-01 10:00:00'
    AND rsi.end_time <= '2025-01-01 12:00:00'
    AND rs.avg_log_bytes_used > 0
ORDER BY (rs.count_executions * rs.avg_log_bytes_used) DESC;



SELECT 
    end_time AS sample_time,
    avg_log_write_percent AS 'Log Write %',
    max_log_write_percent AS 'Max Log Write %',
    avg_data_io_percent AS 'Data IO %',
    avg_cpu_percent AS 'CPU %',
    avg_memory_usage_percent AS 'Memory %'
FROM sys.dm_db_resource_stats
ORDER BY end_time DESC;
